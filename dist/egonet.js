function _applyDecoratedDescriptor(e,t,r,n,i){var o={};return Object.keys(n).forEach((function(e){o[e]=n[e]})),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=r.slice().reverse().reduce((function(r,n){return n(e,t,r)||r}),o),i&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(i):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(e,t,o),o=null),o}const noColor=globalThis.Deno?.noColor??!0;var _class,_dec,_dec1,_dec2;const CR="\r".charCodeAt(0),LF="\n".charCodeAt(0);class BufferFullError extends Error{name="BufferFullError";constructor(e){super("Buffer full"),this.partial=e}}function assert(e,t=""){if(!e)throw new DenoStdInternalError(t)}function copy(e,t,r=0){r=Math.max(0,Math.min(r,t.byteLength));const n=t.byteLength-r;return e.byteLength>n&&(e=e.subarray(0,n)),t.set(e,r),e.byteLength}class BufReader{r=0;w=0;eof=!1;static create(e,t=4096){return e instanceof BufReader?e:new BufReader(e,t)}constructor(e,t=4096){t<16&&(t=16),this._reset(new Uint8Array(t),e)}size(){return this.buf.byteLength}buffered(){return this.w-this.r}async _fill(){if(this.r>0&&(this.buf.copyWithin(0,this.r,this.w),this.w-=this.r,this.r=0),this.w>=this.buf.byteLength)throw Error("bufio: tried to fill full buffer");for(let e=100;e>0;e--){const e=await this.rd.read(this.buf.subarray(this.w));if(null===e)return void(this.eof=!0);if(assert(e>=0,"negative read"),this.w+=e,e>0)return}throw new Error("No progress after 100 read() calls")}reset(e){this._reset(this.buf,e)}_reset(e,t){this.buf=e,this.rd=t,this.eof=!1}async read(e){let t=e.byteLength;if(0===e.byteLength)return t;if(this.r===this.w){if(e.byteLength>=this.buf.byteLength){const t=await this.rd.read(e);return assert((t??0)>=0,"negative read"),t}if(this.r=0,this.w=0,t=await this.rd.read(this.buf),0===t||null===t)return t;assert(t>=0,"negative read"),this.w+=t}const r=copy(this.buf.subarray(this.r,this.w),e,0);return this.r+=r,r}async readFull(e){let t=0;for(;t<e.length;)try{const r=await this.read(e.subarray(t));if(null===r){if(0===t)return null;throw new PartialReadError}t+=r}catch(r){throw r.partial=e.subarray(0,t),r}return e}async readByte(){for(;this.r===this.w;){if(this.eof)return null;await this._fill()}const e=this.buf[this.r];return this.r++,e}async readString(e){if(1!==e.length)throw new Error("Delimiter should be a single character");const t=await this.readSlice(e.charCodeAt(0));return null===t?null:(new TextDecoder).decode(t)}async readLine(){let e;try{e=await this.readSlice(LF)}catch(e){let{partial:t}=e;if(assert(t instanceof Uint8Array,"bufio: caught error from `readSlice()` without `partial` property"),!(e instanceof BufferFullError))throw e;return!this.eof&&t.byteLength>0&&t[t.byteLength-1]===CR&&(assert(this.r>0,"bufio: tried to rewind past start of buffer"),this.r--,t=t.subarray(0,t.byteLength-1)),{line:t,more:!this.eof}}if(null===e)return null;if(0===e.byteLength)return{line:e,more:!1};if(e[e.byteLength-1]==LF){let t=1;e.byteLength>1&&e[e.byteLength-2]===CR&&(t=2),e=e.subarray(0,e.byteLength-t)}return{line:e,more:!1}}async readSlice(e){let t,r=0;for(;;){let n=this.buf.subarray(this.r+r,this.w).indexOf(e);if(n>=0){n+=r,t=this.buf.subarray(this.r,this.r+n+1),this.r+=n+1;break}if(this.eof){if(this.r===this.w)return null;t=this.buf.subarray(this.r,this.w),this.r=this.w;break}if(this.buffered()>=this.buf.byteLength){this.r=this.w;const e=this.buf,t=this.buf.slice(0);throw this.buf=t,new BufferFullError(e)}r=this.w-this.r;try{await this._fill()}catch(e){throw e.partial=t,e}}return t}async peek(e){if(e<0)throw Error("negative count");let t=this.w-this.r;for(;t<e&&t<this.buf.byteLength&&!this.eof;){try{await this._fill()}catch(e){throw e.partial=this.buf.subarray(this.r,this.w),e}t=this.w-this.r}if(0===t&&this.eof)return null;if(t<e&&this.eof)return this.buf.subarray(this.r,this.r+t);if(t<e)throw new BufferFullError(this.buf.subarray(this.r,this.w));return this.buf.subarray(this.r,this.r+e)}}class AbstractBufBase{usedBufferBytes=0;err=null;size(){return this.buf.byteLength}available(){return this.buf.byteLength-this.usedBufferBytes}buffered(){return this.usedBufferBytes}}class BufWriter extends AbstractBufBase{static create(e,t=4096){return e instanceof BufWriter?e:new BufWriter(e,t)}constructor(e,t=4096){super(),this.writer=e,t<=0&&(t=4096),this.buf=new Uint8Array(t)}reset(e){this.err=null,this.usedBufferBytes=0,this.writer=e}async flush(){if(null!==this.err)throw this.err;if(0!==this.usedBufferBytes){try{await Deno.writeAll(this.writer,this.buf.subarray(0,this.usedBufferBytes))}catch(e){throw this.err=e,e}this.buf=new Uint8Array(this.buf.length),this.usedBufferBytes=0}}async write(e){if(null!==this.err)throw this.err;if(0===e.length)return 0;let t=0,r=0;for(;e.byteLength>this.available();){if(0===this.buffered())try{r=await this.writer.write(e)}catch(e){throw this.err=e,e}else r=copy(e,this.buf,this.usedBufferBytes),this.usedBufferBytes+=r,await this.flush();t+=r,e=e.subarray(r)}return r=copy(e,this.buf,this.usedBufferBytes),this.usedBufferBytes+=r,t+=r,t}}class BufWriterSync extends AbstractBufBase{static create(e,t=4096){return e instanceof BufWriterSync?e:new BufWriterSync(e,t)}constructor(e,t=4096){super(),this.writer=e,t<=0&&(t=4096),this.buf=new Uint8Array(t)}reset(e){this.err=null,this.usedBufferBytes=0,this.writer=e}flush(){if(null!==this.err)throw this.err;if(0!==this.usedBufferBytes){try{Deno.writeAllSync(this.writer,this.buf.subarray(0,this.usedBufferBytes))}catch(e){throw this.err=e,e}this.buf=new Uint8Array(this.buf.length),this.usedBufferBytes=0}}writeSync(e){if(null!==this.err)throw this.err;if(0===e.length)return 0;let t=0,r=0;for(;e.byteLength>this.available();){if(0===this.buffered())try{r=this.writer.writeSync(e)}catch(e){throw this.err=e,e}else r=copy(e,this.buf,this.usedBufferBytes),this.usedBufferBytes+=r,this.flush();t+=r,e=e.subarray(r)}return r=copy(e,this.buf,this.usedBufferBytes),this.usedBufferBytes+=r,t+=r,t}}function createLPS(e){const t=new Uint8Array(e.length);t[0]=0;let r=0,n=1;for(;n<t.length;)e[n]==e[r]?(r++,t[n]=r,n++):0===r?(t[n]=0,n++):r=e[r-1];return t}async function*readDelim(e,t){const r=t.length,n=createLPS(t);let i=new Deno.Buffer;const o=new Uint8Array(Math.max(1024,r+1));let a=0,s=0;for(;;){const c=await e.read(o);if(null===c)return void(yield i.bytes());if(c<0)return;const u=o.subarray(0,c);await Deno.writeAll(i,u);let h=i.bytes();for(;a<h.length;)if(h[a]===t[s]){if(a++,s++,s===r){const e=a-r,t=h.subarray(0,e),n=h.slice(a);yield t,h=n,a=0,s=0}}else 0===s?a++:s=n[s-1];i=new Deno.Buffer(h)}}async function*readStringDelim(e,t){const r=new TextEncoder,n=new TextDecoder;for await(const i of readDelim(e,r.encode(t)))yield n.decode(i)}function indexOf(e,t,r=0){if(r>=e.length)return-1;r<0&&(r=0);const n=t[0];for(let i=r;i<e.length;i++){if(e[i]!==n)continue;let r=1,o=i;for(;r<t.length&&(o++,e[o]===t[o-i]);)r++;if(r===t.length)return i}return-1}function concat(...e){let t=0;for(const r of e)t+=r.length;const r=new Uint8Array(t);let n=0;for(const t of e)r.set(t,n),n+=t.length;return r}const invalidHeaderCharRegex=/[^\t\x20-\x7e\x80-\xff]/g,decoder=new TextDecoder;function decode(e){return decoder.decode(e)}function str(e){return null==e?"":decode(e)}function charCode(e){return e.charCodeAt(0)}class TextProtoReader{constructor(e){this.r=e}async readLine(){const e=await this.readLineSlice();return null===e?null:str(e)}async readMIMEHeader(){const e=new Headers;let t,r=await this.r.peek(1);if(null===r)return null;if(r[0]!=charCode(" ")&&r[0]!=charCode("\t")||(t=await this.readLineSlice()),r=await this.r.peek(1),null===r)throw new Deno.errors.UnexpectedEof;if(r[0]==charCode(" ")||r[0]==charCode("\t"))throw new Deno.errors.InvalidData(`malformed MIME header initial line: ${str(t)}`);for(;;){const t=await this.readLineSlice();if(null===t)throw new Deno.errors.UnexpectedEof;if(0===t.byteLength)return e;let r=t.indexOf(charCode(":"));if(r<0)throw new Deno.errors.InvalidData(`malformed MIME header line: ${str(t)}`);const n=str(t.subarray(0,r));if(""==n)continue;for(r++;r<t.byteLength&&(t[r]==charCode(" ")||t[r]==charCode("\t"));)r++;const i=str(t.subarray(r)).replace(invalidHeaderCharRegex,encodeURI);try{e.append(n,i)}catch{}}}async readLineSlice(){let e;for(;;){const t=await this.r.readLine();if(null===t)return null;const{line:r,more:n}=t;if(!e&&!n)return 0===this.skipSpace(r)?new Uint8Array(0):r;if(e=e?concat(e,r):r,!n)break}return e}skipSpace(e){let t=0;for(let r=0;r<e.length;r++)e[r]!==charCode(" ")&&e[r]!==charCode("\t")&&t++;return t}}const encoder=new TextEncoder;function encode(e){return encoder.encode(e)}function emptyReader(){return{read:e=>Promise.resolve(null)}}function bodyReader(e,t){let r=0,n=!1;return{read:async function(i){if(n)return null;let o;const a=e-r;if(a>=i.byteLength)o=await t.read(i);else{const e=i.subarray(0,a);o=await t.read(e)}return null!==o&&(r+=o),n=r===e,o}}}function deferred(){let e;const t=new Promise(((t,r)=>{e={resolve:t,reject:r}}));return Object.assign(t,e)}function chunkedBodyReader(e,t){const r=new TextProtoReader(t);let n=!1;const i=[];return{read:async function(o){if(n)return null;const[a]=i;if(a){const e=a.data.byteLength-a.offset,t=Math.min(e,o.byteLength);for(let e=0;e<t;e++)o[e]=a.data[a.offset+e];if(a.offset+=t,a.offset===a.data.byteLength&&(i.shift(),null===await r.readLine()))throw new Deno.errors.UnexpectedEof;return t}const s=await r.readLine();if(null===s)throw new Deno.errors.UnexpectedEof;const[c]=s.split(";"),u=parseInt(c,16);if(Number.isNaN(u)||u<0)throw new Deno.errors.InvalidData("Invalid chunk size");if(u>0){if(u>o.byteLength){let e=await t.readFull(o);if(null===e)throw new Deno.errors.UnexpectedEof;const r=new Uint8Array(u-o.byteLength);if(e=await t.readFull(r),null===e)throw new Deno.errors.UnexpectedEof;return i.push({offset:0,data:r}),o.byteLength}{const e=o.subarray(0,u);if(null===await t.readFull(e))throw new Deno.errors.UnexpectedEof;if(null===await r.readLine())throw new Deno.errors.UnexpectedEof;return u}}if(assert(0===u),null===await t.readLine())throw new Deno.errors.UnexpectedEof;return await readTrailers(e,t),n=!0,null}}}function isProhibidedForTrailer(e){return new Set(["transfer-encoding","content-length","trailer"]).has(e.toLowerCase())}async function readTrailers(e,t){const r=parseTrailer(e.get("trailer"));if(null==r)return;const n=[...r.keys()],i=new TextProtoReader(t),o=await i.readMIMEHeader();if(null==o)throw new Deno.errors.InvalidData("Missing trailer header.");const a=[...o.keys()].filter((e=>!n.includes(e)));if(a.length>0)throw new Deno.errors.InvalidData(`Undeclared trailers: ${Deno.inspect(a)}.`);for(const[t,r]of o)e.append(t,r);const s=n.filter((e=>!o.has(e)));if(s.length>0)throw new Deno.errors.InvalidData(`Missing trailers: ${Deno.inspect(s)}.`);e.delete("trailer")}function parseTrailer(e){if(null==e)return;const t=e.split(",").map((e=>e.trim().toLowerCase()));if(0===t.length)throw new Deno.errors.InvalidData("Empty trailer header.");const r=t.filter((e=>isProhibidedForTrailer(e)));if(r.length>0)throw new Deno.errors.InvalidData(`Prohibited trailer names: ${Deno.inspect(r)}.`);return new Headers(t.map((e=>[e,""])))}var Status;async function writeChunkedBody(e,t){for await(const r of Deno.iter(t)){if(r.byteLength<=0)continue;const t=encoder.encode(`${r.byteLength.toString(16)}\r\n`),n=encoder.encode("\r\n");await e.write(t),await e.write(r),await e.write(n),await e.flush()}const r=encoder.encode("0\r\n\r\n");await e.write(r)}!function(e){e[e.Continue=100]="Continue",e[e.SwitchingProtocols=101]="SwitchingProtocols",e[e.Processing=102]="Processing",e[e.EarlyHints=103]="EarlyHints",e[e.OK=200]="OK",e[e.Created=201]="Created",e[e.Accepted=202]="Accepted",e[e.NonAuthoritativeInfo=203]="NonAuthoritativeInfo",e[e.NoContent=204]="NoContent",e[e.ResetContent=205]="ResetContent",e[e.PartialContent=206]="PartialContent",e[e.MultiStatus=207]="MultiStatus",e[e.AlreadyReported=208]="AlreadyReported",e[e.IMUsed=226]="IMUsed",e[e.MultipleChoices=300]="MultipleChoices",e[e.MovedPermanently=301]="MovedPermanently",e[e.Found=302]="Found",e[e.SeeOther=303]="SeeOther",e[e.NotModified=304]="NotModified",e[e.UseProxy=305]="UseProxy",e[e.TemporaryRedirect=307]="TemporaryRedirect",e[e.PermanentRedirect=308]="PermanentRedirect",e[e.BadRequest=400]="BadRequest",e[e.Unauthorized=401]="Unauthorized",e[e.PaymentRequired=402]="PaymentRequired",e[e.Forbidden=403]="Forbidden",e[e.NotFound=404]="NotFound",e[e.MethodNotAllowed=405]="MethodNotAllowed",e[e.NotAcceptable=406]="NotAcceptable",e[e.ProxyAuthRequired=407]="ProxyAuthRequired",e[e.RequestTimeout=408]="RequestTimeout",e[e.Conflict=409]="Conflict",e[e.Gone=410]="Gone",e[e.LengthRequired=411]="LengthRequired",e[e.PreconditionFailed=412]="PreconditionFailed",e[e.RequestEntityTooLarge=413]="RequestEntityTooLarge",e[e.RequestURITooLong=414]="RequestURITooLong",e[e.UnsupportedMediaType=415]="UnsupportedMediaType",e[e.RequestedRangeNotSatisfiable=416]="RequestedRangeNotSatisfiable",e[e.ExpectationFailed=417]="ExpectationFailed",e[e.Teapot=418]="Teapot",e[e.MisdirectedRequest=421]="MisdirectedRequest",e[e.UnprocessableEntity=422]="UnprocessableEntity",e[e.Locked=423]="Locked",e[e.FailedDependency=424]="FailedDependency",e[e.TooEarly=425]="TooEarly",e[e.UpgradeRequired=426]="UpgradeRequired",e[e.PreconditionRequired=428]="PreconditionRequired",e[e.TooManyRequests=429]="TooManyRequests",e[e.RequestHeaderFieldsTooLarge=431]="RequestHeaderFieldsTooLarge",e[e.UnavailableForLegalReasons=451]="UnavailableForLegalReasons",e[e.InternalServerError=500]="InternalServerError",e[e.NotImplemented=501]="NotImplemented",e[e.BadGateway=502]="BadGateway",e[e.ServiceUnavailable=503]="ServiceUnavailable",e[e.GatewayTimeout=504]="GatewayTimeout",e[e.HTTPVersionNotSupported=505]="HTTPVersionNotSupported",e[e.VariantAlsoNegotiates=506]="VariantAlsoNegotiates",e[e.InsufficientStorage=507]="InsufficientStorage",e[e.LoopDetected=508]="LoopDetected",e[e.NotExtended=510]="NotExtended",e[e.NetworkAuthenticationRequired=511]="NetworkAuthenticationRequired"}(Status||(Status={}));const STATUS_TEXT=new Map([[Status.Continue,"Continue"],[Status.SwitchingProtocols,"Switching Protocols"],[Status.Processing,"Processing"],[Status.EarlyHints,"Early Hints"],[Status.OK,"OK"],[Status.Created,"Created"],[Status.Accepted,"Accepted"],[Status.NonAuthoritativeInfo,"Non-Authoritative Information"],[Status.NoContent,"No Content"],[Status.ResetContent,"Reset Content"],[Status.PartialContent,"Partial Content"],[Status.MultiStatus,"Multi-Status"],[Status.AlreadyReported,"Already Reported"],[Status.IMUsed,"IM Used"],[Status.MultipleChoices,"Multiple Choices"],[Status.MovedPermanently,"Moved Permanently"],[Status.Found,"Found"],[Status.SeeOther,"See Other"],[Status.NotModified,"Not Modified"],[Status.UseProxy,"Use Proxy"],[Status.TemporaryRedirect,"Temporary Redirect"],[Status.PermanentRedirect,"Permanent Redirect"],[Status.BadRequest,"Bad Request"],[Status.Unauthorized,"Unauthorized"],[Status.PaymentRequired,"Payment Required"],[Status.Forbidden,"Forbidden"],[Status.NotFound,"Not Found"],[Status.MethodNotAllowed,"Method Not Allowed"],[Status.NotAcceptable,"Not Acceptable"],[Status.ProxyAuthRequired,"Proxy Authentication Required"],[Status.RequestTimeout,"Request Timeout"],[Status.Conflict,"Conflict"],[Status.Gone,"Gone"],[Status.LengthRequired,"Length Required"],[Status.PreconditionFailed,"Precondition Failed"],[Status.RequestEntityTooLarge,"Request Entity Too Large"],[Status.RequestURITooLong,"Request URI Too Long"],[Status.UnsupportedMediaType,"Unsupported Media Type"],[Status.RequestedRangeNotSatisfiable,"Requested Range Not Satisfiable"],[Status.ExpectationFailed,"Expectation Failed"],[Status.Teapot,"I'm a teapot"],[Status.MisdirectedRequest,"Misdirected Request"],[Status.UnprocessableEntity,"Unprocessable Entity"],[Status.Locked,"Locked"],[Status.FailedDependency,"Failed Dependency"],[Status.TooEarly,"Too Early"],[Status.UpgradeRequired,"Upgrade Required"],[Status.PreconditionRequired,"Precondition Required"],[Status.TooManyRequests,"Too Many Requests"],[Status.RequestHeaderFieldsTooLarge,"Request Header Fields Too Large"],[Status.UnavailableForLegalReasons,"Unavailable For Legal Reasons"],[Status.InternalServerError,"Internal Server Error"],[Status.NotImplemented,"Not Implemented"],[Status.BadGateway,"Bad Gateway"],[Status.ServiceUnavailable,"Service Unavailable"],[Status.GatewayTimeout,"Gateway Timeout"],[Status.HTTPVersionNotSupported,"HTTP Version Not Supported"],[Status.VariantAlsoNegotiates,"Variant Also Negotiates"],[Status.InsufficientStorage,"Insufficient Storage"],[Status.LoopDetected,"Loop Detected"],[Status.NotExtended,"Not Extended"],[Status.NetworkAuthenticationRequired,"Network Authentication Required"]]);async function writeTrailers(e,t,r){const n=t.get("trailer");if(null===n)throw new TypeError("Missing trailer header.");const i=t.get("transfer-encoding");if(null===i||!i.match(/^chunked/))throw new TypeError(`Trailers are only allowed for "transfer-encoding: chunked", got "transfer-encoding: ${i}".`);const o=BufWriter.create(e),a=n.split(",").map((e=>e.trim().toLowerCase())),s=a.filter((e=>isProhibidedForTrailer(e)));if(s.length>0)throw new TypeError(`Prohibited trailer names: ${Deno.inspect(s)}.`);const c=[...r.keys()].filter((e=>!a.includes(e)));if(c.length>0)throw new TypeError(`Undeclared trailers: ${Deno.inspect(c)}.`);for(const[e,t]of r)await o.write(encoder.encode(`${e}: ${t}\r\n`));await o.write(encoder.encode("\r\n")),await o.flush()}async function writeResponse(e,t){const r=t.status||200,n=STATUS_TEXT.get(r),i=BufWriter.create(e);if(!n)throw new Deno.errors.InvalidData("Bad status code");t.body||(t.body=new Uint8Array),"string"==typeof t.body&&(t.body=encoder.encode(t.body));let o=`HTTP/1.1 ${r} ${n}\r\n`;const a=t.headers??new Headers;t.body&&!a.get("content-length")&&(t.body instanceof Uint8Array?o+=`content-length: ${t.body.byteLength}\r\n`:a.get("transfer-encoding")||(o+="transfer-encoding: chunked\r\n"));for(const[e,t]of a)o+=`${e}: ${t}\r\n`;o+="\r\n";const s=encoder.encode(o);if(assert(await i.write(s)===s.byteLength),t.body instanceof Uint8Array){assert(await i.write(t.body)===t.body.byteLength)}else if(a.has("content-length")){const e=a.get("content-length");assert(null!=e);const r=parseInt(e);assert(await Deno.copy(t.body,i)===r)}else await writeChunkedBody(i,t.body);if(t.trailers){const e=await t.trailers();await writeTrailers(i,a,e)}await i.flush()}function parseHTTPVersion(e){switch(e){case"HTTP/1.1":return[1,1];case"HTTP/1.0":return[1,0];default:{if(!e.startsWith("HTTP/"))break;const t=e.indexOf(".");if(t<0)break;const r=e.substring(e.indexOf("/")+1,t),n=Number(r);if(!Number.isInteger(n)||n<0||n>1e6)break;const i=e.substring(t+1),o=Number(i);if(!Number.isInteger(o)||o<0||o>1e6)break;return[n,o]}}throw new Error(`malformed HTTP version ${e}`)}class ServerRequest{done=deferred();_contentLength=void 0;get contentLength(){if(void 0===this._contentLength){const e=this.headers.get("content-length");e?(this._contentLength=parseInt(e),Number.isNaN(this._contentLength)&&(this._contentLength=null)):this._contentLength=null}return this._contentLength}_body=null;get body(){if(!this._body)if(null!=this.contentLength)this._body=bodyReader(this.contentLength,this.r);else{const e=this.headers.get("transfer-encoding");if(null!=e){assert(e.split(",").map((e=>e.trim().toLowerCase())).includes("chunked"),'transfer-encoding must include "chunked" if content-length is not set'),this._body=chunkedBodyReader(this.headers,this.r)}else this._body=emptyReader()}return this._body}async respond(e){let t;try{await writeResponse(this.w,e)}catch(e){try{this.conn.close()}catch{}t=e}if(this.done.resolve(t),t)throw t}finalized=!1;async finalize(){if(this.finalized)return;const e=this.body,t=new Uint8Array(1024);for(;null!==await e.read(t););this.finalized=!0}}async function readRequest(e,t){const r=new TextProtoReader(t),n=await r.readLine();if(null===n)return null;const i=await r.readMIMEHeader();if(null===i)throw new Deno.errors.UnexpectedEof;const o=new ServerRequest;return o.conn=e,o.r=t,[o.method,o.url,o.proto]=n.split(" ",3),[o.protoMinor,o.protoMajor]=parseHTTPVersion(o.proto),o.headers=i,fixLength(o),o}function fixLength(e){const t=e.headers.get("Content-Length");if(t){const r=t.split(",");if(r.length>1){const t=[...new Set(r.map((e=>e.trim())))];if(t.length>1)throw Error("cannot contain multiple Content-Length headers");e.headers.set("Content-Length",t[0])}const n=e.headers.get("Content-Length");if("HEAD"===e.method&&n&&"0"!==n)throw Error("http: method cannot contain a Content-Length");if(n&&e.headers.has("transfer-encoding"))throw new Error("http: Transfer-Encoding and Content-Length cannot be send together")}}class MuxAsyncIterator{iteratorCount=0;yields=[];__throws=[];signal=deferred();add(e){++this.iteratorCount,this.callIteratorNext(e)}async callIteratorNext(e){try{const{value:t,done:r}=await e.next();r?--this.iteratorCount:this.yields.push({iterator:e,value:t})}catch(e){this.throws.push(e)}this.signal.resolve()}async*iterate(){for(;this.iteratorCount>0;){await this.signal;for(let e=0;e<this.yields.length;e++){const{iterator:t,value:r}=this.yields[e];yield r,this.callIteratorNext(t)}if(this.throws.length){for(const e of this.throws)throw e;this.throws.length=0}this.yields.length=0,this.signal=deferred()}}[Symbol.asyncIterator](){return this.iterate()}}class Server{closing=!1;connections=[];constructor(e){this.listener=e}close(){this.closing=!0,this.listener.close();for(const e of this.connections)try{e.close()}catch(e){if(!(e instanceof Deno.errors.BadResource))throw e}}async*iterateHttpRequests(e){const t=new BufReader(e),r=new BufWriter(e);for(;!this.closing;){let n;try{n=await readRequest(e,t)}catch(e){if(e instanceof Deno.errors.InvalidData||e instanceof Deno.errors.UnexpectedEof)try{await writeResponse(r,{status:400,body:encode(`${e.message}\r\n\r\n`)})}catch(e){}break}if(null===n)break;n.w=r,yield n;if(await n.done)return void this.untrackConnection(n.conn);try{await n.finalize()}catch(e){break}}this.untrackConnection(e);try{e.close()}catch(e){}}trackConnection(e){this.connections.push(e)}untrackConnection(e){const t=this.connections.indexOf(e);-1!==t&&this.connections.splice(t,1)}async*acceptConnAndIterateHttpRequests(e){if(this.closing)return;let t;try{t=await this.listener.accept()}catch(t){if(t instanceof Deno.errors.BadResource||t instanceof Deno.errors.InvalidData||t instanceof Deno.errors.UnexpectedEof||t instanceof Deno.errors.ConnectionReset)return e.add(this.acceptConnAndIterateHttpRequests(e));throw t}this.trackConnection(t),e.add(this.acceptConnAndIterateHttpRequests(e)),yield*this.iterateHttpRequests(t)}[Symbol.asyncIterator](){const e=new MuxAsyncIterator;return e.add(this.acceptConnAndIterateHttpRequests(e)),e.iterate()}}function _parseAddrFromStr(e){let t;try{const r=e.startsWith(":")?`0.0.0.0${e}`:e;t=new URL(`http://${r}`)}catch{throw new TypeError("Invalid address.")}if(t.username||t.password||"/"!=t.pathname||t.search||t.hash)throw new TypeError("Invalid address.");return{hostname:t.hostname,port:""===t.port?80:Number(t.port)}}function serve(e){"string"==typeof e&&(e=_parseAddrFromStr(e));const t=Deno.listen(e);return new Server(t)}function serveTLS(e){const t={...e,transport:"tcp"},r=Deno.listenTls(t);return new Server(r)}const noColor1=globalThis.Deno?.noColor??!0;let enabled=!noColor1;function code(e,t){return{open:`[${e.join(";")}m`,close:`[${t}m`,regexp:new RegExp(`\\x1b\\[${t}m`,"g")}}function run(e,t){return enabled?`${t.open}${e.replace(t.regexp,t.open)}${t.close}`:e}function bold(e){return run(e,code([1],22))}function underline(e){return run(e,code([4],24))}function brightBlack(e){return run(e,code([90],39))}function brightRed(e){return run(e,code([91],39))}function brightGreen(e){return run(e,code([92],39))}function brightYellow(e){return run(e,code([93],39))}function brightCyan(e){return run(e,code([96],39))}function clampAndTruncate(e,t=255,r=0){return Math.trunc(Math.max(Math.min(e,t),r))}const ANSI_PATTERN=new RegExp(["[\\u001B\\u009B][[\\]()#;?]*(?:(?:(?:[a-zA-Z\\d]*(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]*)*)?\\u0007)","(?:(?:\\d{1,4}(?:;\\d{0,4})*)?[\\dA-PR-TZcf-ntqry=><~]))"].join("|"),"g");function stripColor(e){return e.replace(ANSI_PATTERN,"")}function _applyDecoratedDescriptor1(e,t,r,n,i){var o={};return Object.keys(n).forEach((function(e){o[e]=n[e]})),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=r.slice().reverse().reduce((function(r,n){return n(e,t,r)||r}),o),i&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(i):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(e,t,o),o=null),o}var _class1,_dec3,_dec4,_dec5,_dec6,Status1;!function(e){e[e.Continue=100]="Continue",e[e.SwitchingProtocols=101]="SwitchingProtocols",e[e.Processing=102]="Processing",e[e.EarlyHints=103]="EarlyHints",e[e.OK=200]="OK",e[e.Created=201]="Created",e[e.Accepted=202]="Accepted",e[e.NonAuthoritativeInfo=203]="NonAuthoritativeInfo",e[e.NoContent=204]="NoContent",e[e.ResetContent=205]="ResetContent",e[e.PartialContent=206]="PartialContent",e[e.MultiStatus=207]="MultiStatus",e[e.AlreadyReported=208]="AlreadyReported",e[e.IMUsed=226]="IMUsed",e[e.MultipleChoices=300]="MultipleChoices",e[e.MovedPermanently=301]="MovedPermanently",e[e.Found=302]="Found",e[e.SeeOther=303]="SeeOther",e[e.NotModified=304]="NotModified",e[e.UseProxy=305]="UseProxy",e[e.TemporaryRedirect=307]="TemporaryRedirect",e[e.PermanentRedirect=308]="PermanentRedirect",e[e.BadRequest=400]="BadRequest",e[e.Unauthorized=401]="Unauthorized",e[e.PaymentRequired=402]="PaymentRequired",e[e.Forbidden=403]="Forbidden",e[e.NotFound=404]="NotFound",e[e.MethodNotAllowed=405]="MethodNotAllowed",e[e.NotAcceptable=406]="NotAcceptable",e[e.ProxyAuthRequired=407]="ProxyAuthRequired",e[e.RequestTimeout=408]="RequestTimeout",e[e.Conflict=409]="Conflict",e[e.Gone=410]="Gone",e[e.LengthRequired=411]="LengthRequired",e[e.PreconditionFailed=412]="PreconditionFailed",e[e.RequestEntityTooLarge=413]="RequestEntityTooLarge",e[e.RequestURITooLong=414]="RequestURITooLong",e[e.UnsupportedMediaType=415]="UnsupportedMediaType",e[e.RequestedRangeNotSatisfiable=416]="RequestedRangeNotSatisfiable",e[e.ExpectationFailed=417]="ExpectationFailed",e[e.Teapot=418]="Teapot",e[e.MisdirectedRequest=421]="MisdirectedRequest",e[e.UnprocessableEntity=422]="UnprocessableEntity",e[e.Locked=423]="Locked",e[e.FailedDependency=424]="FailedDependency",e[e.TooEarly=425]="TooEarly",e[e.UpgradeRequired=426]="UpgradeRequired",e[e.PreconditionRequired=428]="PreconditionRequired",e[e.TooManyRequests=429]="TooManyRequests",e[e.RequestHeaderFieldsTooLarge=431]="RequestHeaderFieldsTooLarge",e[e.UnavailableForLegalReasons=451]="UnavailableForLegalReasons",e[e.InternalServerError=500]="InternalServerError",e[e.NotImplemented=501]="NotImplemented",e[e.BadGateway=502]="BadGateway",e[e.ServiceUnavailable=503]="ServiceUnavailable",e[e.GatewayTimeout=504]="GatewayTimeout",e[e.HTTPVersionNotSupported=505]="HTTPVersionNotSupported",e[e.VariantAlsoNegotiates=506]="VariantAlsoNegotiates",e[e.InsufficientStorage=507]="InsufficientStorage",e[e.LoopDetected=508]="LoopDetected",e[e.NotExtended=510]="NotExtended",e[e.NetworkAuthenticationRequired=511]="NetworkAuthenticationRequired"}(Status1||(Status1={}));var exports={},_dewExec=!1,_global="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:global,exports1={},_dewExec1=!1;function dew(){if(_dewExec1)return exports1;return _dewExec1=!0,exports1=function(e){!function(e){if(!e)throw new Error("Eventify cannot use falsy object as events subject");for(var t=["on","fire","off"],r=0;r<t.length;++r)if(e.hasOwnProperty(t[r]))throw new Error("Subject cannot be eventified, since it already has property '"+t[r]+"'")}(e);var t=function(e){var t=Object.create(null);return{on:function(r,n,i){if("function"!=typeof n)throw new Error("callback is expected to be a function");var o=t[r];return o||(o=t[r]=[]),o.push({callback:n,ctx:i}),e},off:function(r,n){if(void 0===r)return t=Object.create(null),e;if(t[r])if("function"!=typeof n)delete t[r];else for(var i=t[r],o=0;o<i.length;++o)i[o].callback===n&&i.splice(o,1);return e},fire:function(r){var n,i=t[r];if(!i)return e;arguments.length>1&&(n=Array.prototype.splice.call(arguments,1));for(var o=0;o<i.length;++o){var a=i[o];a.callback.apply(a.ctx,n)}return e}}}(e);return e.on=t.on,e.off=t.off,e.fire=t.fire,e}}function dew1(){if(_dewExec)return exports;_dewExec=!0,exports=function(a){"uniqueLinkId"in(a=a||{})&&(console.warn("ngraph.graph: Starting from version 0.14 `uniqueLinkId` is deprecated.\nUse `multigraph` option instead\n","\n","Note: there is also change in default behavior: From now on each graph\nis considered to be not a multigraph by default (each edge is unique)."),a.multigraph=a.uniqueLinkId);void 0===a.multigraph&&(a.multigraph=!1);if("function"!=typeof Map)throw new Error("ngraph.graph requires `Map` to be defined. Please polyfill it before using ngraph");var s=new Map,c=[],u={},h=0,l=a.multigraph?function(e,t,r){var n=o(e,t),a=u.hasOwnProperty(n);if(a||A(e,t)){a||(u[n]=0);var s="@"+ ++u[n];n=o(e+s,t+s)}return new i(e,t,r,n)}:function(e,t,r){var n=o(e,t);return new i(e,t,r,n)},d=[],f=k,p=k,y=k,g=k,w={addNode:m,addLink:function(e,t,r){y();var i=v(e)||m(e),o=v(t)||m(t),a=l(e,t,r);c.push(a),n(i,a),e!==t&&n(o,a);return f(a,"add"),g(),a},removeLink:E,removeNode:R,getNode:v,getNodeCount:S,getLinkCount:T,getLinksCount:T,getNodesCount:S,getLinks:function(e){var t=v(e);return t?t.links:null},forEachNode:P,forEachLinkedNode:function(e,t,r){var n=v(e);if(n&&n.links&&"function"==typeof t)return r?function(e,t,r){for(var n=0;n<e.length;++n){var i=e[n];if(i.fromId===t&&r(s.get(i.toId),i))return!0}}(n.links,e,t):function(e,t,r){for(var n=0;n<e.length;++n){var i=e[n],o=i.fromId===t?i.toId:i.fromId;if(r(s.get(o),i))return!0}}(n.links,e,t)},forEachLink:function(e){var t,r;if("function"==typeof e)for(t=0,r=c.length;t<r;++t)e(c[t])},beginUpdate:y,endUpdate:g,clear:function(){y(),P((function(e){R(e.id)})),g()},hasLink:A,hasNode:v,getLink:A};return e(w),function(){var e=w.on;function t(){return w.beginUpdate=y=L,w.endUpdate=g=x,f=b,p=_,w.on=e,e.apply(w,arguments)}w.on=t}(),w;function b(e,t){d.push({link:e,changeType:t})}function _(e,t){d.push({node:e,changeType:t})}function m(e,t){if(void 0===e)throw new Error("Invalid node identifier");y();var n=v(e);return n?(n.data=t,p(n,"update")):(n=new r(e,t),p(n,"add")),s.set(e,n),g(),n}function v(e){return s.get(e)}function R(e){var t=v(e);if(!t)return!1;y();var r=t.links;if(r){t.links=null;for(var n=0;n<r.length;++n)E(r[n])}return s.delete(e),p(t,"remove"),g(),!0}function S(){return s.size}function T(){return c.length}function E(e){if(!e)return!1;var r=t(e,c);if(r<0)return!1;y(),c.splice(r,1);var n=v(e.fromId),i=v(e.toId);return n&&(r=t(e,n.links))>=0&&n.links.splice(r,1),i&&(r=t(e,i.links))>=0&&i.links.splice(r,1),f(e,"remove"),g(),!0}function A(e,t){var r,n=v(e);if(!n||!n.links)return null;for(r=0;r<n.links.length;++r){var i=n.links[r];if(i.fromId===e&&i.toId===t)return i}return null}function k(){}function L(){h+=1}function x(){0===(h-=1)&&d.length>0&&(w.fire("changed",d),d.length=0)}function P(e){if("function"!=typeof e)throw new Error("Function is expected to iterate over graph nodes. You passed "+e);for(var t=s.values(),r=t.next();!r.done;){if(e(r.value))return!0;r=t.next()}}};var e=dew();function t(e,t){if(!t)return-1;if(t.indexOf)return t.indexOf(e);var r,n=t.length;for(r=0;r<n;r+=1)if(t[r]===e)return r;return-1}function r(e,t){(this||_global).id=e,(this||_global).links=null,(this||_global).data=t}function n(e,t){e.links?e.links.push(t):e.links=[t]}function i(e,t,r,n){(this||_global).fromId=e,(this||_global).toId=t,(this||_global).data=r,(this||_global).id=n}function o(e,t){return e.toString()+"👉 "+t.toString()}return exports}const __default=dew1();let enabled1=!noColor;function code1(e,t){return{open:`[${e.join(";")}m`,close:`[${t}m`,regexp:new RegExp(`\\x1b\\[${t}m`,"g")}}function run1(e,t){return enabled1?`${t.open}${e.replace(t.regexp,t.open)}${t.close}`:e}function bold1(e){return run1(e,code1([1],22))}function green(e){return run1(e,code1([32],39))}function brightBlack1(e){return run1(e,code1([90],39))}function brightRed1(e){return run1(e,code1([91],39))}function brightYellow1(e){return run1(e,code1([93],39))}function brightMagenta(e){return run1(e,code1([95],39))}function brightCyan1(e){return run1(e,code1([96],39))}function clampAndTruncate1(e,t=255,r=0){return Math.trunc(Math.max(Math.min(e,t),r))}function Timeout(e=1e4){return function(t,r,n){const i=n.value;return n.value=async function(...t){try{return await timeoutAsync.apply(this,[i,t,e])}catch(t){throw"timeout"===t.message&&(t.message=`${bold1("Timeout ("+String(e)+"ms")}) exceeded for ${brightMagenta(r+"(…)")}`,Error.captureStackTrace(t,n.value)),t}},n}}function timeoutAsync(e,t,r){let n;return Promise.race([new Promise(((e,t)=>{n=setTimeout((()=>{clearTimeout(n),t(new Error("timeout"))}),r)})),e.apply(this,t)]).then((e=>(clearTimeout(n),e)))}function Trace(e={stack:!1}){return function(t,r,n){const i=n.value;let o;return n.value=async function(...t){const a=new Error;Error.captureStackTrace(a,e.stack?void 0:n.value);const s=e.stack?"\n"+a.stack?.split("\n").slice(1).join("\n"):a.stack?.split("\n").slice(1)[0]?.replace("at","").trim(),c=performance.now();let u;return console.log(`${brightMagenta(r+"(…)")} ${bold1("called")} ${e.stack?"":"from"} ${brightCyan1(s??o??"unknown")}`),s&&(o=s),u="AsyncFunction"===i.constructor.name?await i.apply(this,t):i.apply(this,t),console.log(`${brightMagenta(r+"(…)")} ${green("ended")} in ${brightYellow1((performance.now()-c).toFixed()+"ms")}`),u},n}}var BackOffPolicy;!function(e){e.FixedBackOffPolicy="FixedBackOffPolicy",e.ExponentialBackOffPolicy="ExponentialBackOffPolicy"}(BackOffPolicy||(BackOffPolicy={}));const sleep=e=>new Promise((t=>setTimeout(t,e)));function Retry(e={maxAttempts:3}){return function(r,n,i){const o=i.value;return e.backOffPolicy===BackOffPolicy.ExponentialBackOffPolicy&&(!e.backOff&&(e.backOff=1e3),e.exponentialOption={maxInterval:2e3,multiplier:2,...e.exponentialOption}),i.value=async function(...r){try{return await t.apply(this,[o,r,e.maxAttempts,e.backOff,e.doRetry])}catch(t){throw"maxAttempts"===t.message&&(t.code="429",t.message=`${brightRed1("Failed")} for ${brightMagenta(n+"(…)")} for ${brightYellow1(e.maxAttempts.toString())} times.`),t}},i};async function t(r,n,i,o,a){try{return await r.apply(this,n)}catch(c){if(--i<0)throw console.error(c?.message),new Error("maxAttempts");if(a&&!a(c))throw c;if(o&&(await(s=o,new Promise((e=>setTimeout(e,s)))),e.backOffPolicy===BackOffPolicy.ExponentialBackOffPolicy&&e.exponentialOption)){const t=o*e.exponentialOption.multiplier;o=t>e.exponentialOption.maxInterval?e.exponentialOption.maxInterval:t}return t.apply(this,[r,n,i,o,a])}var s}}class LruCache{values=new Map;maxEntries=500;get(e){const t=this.values.get(e);return void 0!==t&&(this.values.delete(e),this.values.set(e,t)),t}has(e){return this.values.has(e)}put(e,t){if(this.values.size>=this.maxEntries){const e=this.values.keys().next().value;this.values.delete(e)}this.values.set(e,t)}}function Memoize(e={}){return function(t,r,n){const i=n.value,o=new LruCache;let a=Number.POSITIVE_INFINITY;return n.value=async function(...t){const r=e.resolver?e.resolver.apply(this,t):JSON.stringify(t);if(o.has(r)&&(!e.ttl||a>Date.now())){const t=o.get(r);return e.onFound?.apply(this,[r,t]),t}{const n=await i.apply(this,t);return o.put(r,n),e.onAdded?.apply(this,[r,n]),e.ttl&&(a=Date.now()+e.ttl),n}},n}}class RateLimitError extends Error{}var exports2={},_dewExec2=!1;function dew2(){if(_dewExec2)return exports2;function e(e){this._head=0,this._tail=0,this._capacityMask=3,this._list=new Array(4),Array.isArray(e)&&this._fromArray(e)}return _dewExec2=!0,e.prototype.peekAt=function(e){var t=e;if(t===(0|t)){var r=this.size();if(!(t>=r||t<-r))return t<0&&(t+=r),t=this._head+t&this._capacityMask,this._list[t]}},e.prototype.get=function(e){return this.peekAt(e)},e.prototype.peek=function(){if(this._head!==this._tail)return this._list[this._head]},e.prototype.peekFront=function(){return this.peek()},e.prototype.peekBack=function(){return this.peekAt(-1)},Object.defineProperty(e.prototype,"length",{get:function(){return this.size()}}),e.prototype.size=function(){return this._head===this._tail?0:this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},e.prototype.unshift=function(e){if(void 0===e)return this.size();var t=this._list.length;return this._head=this._head-1+t&this._capacityMask,this._list[this._head]=e,this._tail===this._head&&this._growArray(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},e.prototype.shift=function(){var e=this._head;if(e!==this._tail){var t=this._list[e];return this._list[e]=void 0,this._head=e+1&this._capacityMask,e<2&&this._tail>1e4&&this._tail<=this._list.length>>>2&&this._shrinkArray(),t}},e.prototype.push=function(e){if(void 0===e)return this.size();var t=this._tail;return this._list[t]=e,this._tail=t+1&this._capacityMask,this._tail===this._head&&this._growArray(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},e.prototype.pop=function(){var e=this._tail;if(e!==this._head){var t=this._list.length;this._tail=e-1+t&this._capacityMask;var r=this._list[this._tail];return this._list[this._tail]=void 0,this._head<2&&e>1e4&&e<=t>>>2&&this._shrinkArray(),r}},e.prototype.removeOne=function(e){var t=e;if(t===(0|t)&&this._head!==this._tail){var r=this.size(),n=this._list.length;if(!(t>=r||t<-r)){t<0&&(t+=r),t=this._head+t&this._capacityMask;var i,o=this._list[t];if(e<r/2){for(i=e;i>0;i--)this._list[t]=this._list[t=t-1+n&this._capacityMask];this._list[t]=void 0,this._head=this._head+1+n&this._capacityMask}else{for(i=r-1-e;i>0;i--)this._list[t]=this._list[t=t+1+n&this._capacityMask];this._list[t]=void 0,this._tail=this._tail-1+n&this._capacityMask}return o}}},e.prototype.remove=function(e,t){var r,n=e,i=t;if(n===(0|n)&&this._head!==this._tail){var o=this.size(),a=this._list.length;if(!(n>=o||n<-o||t<1)){if(n<0&&(n+=o),1===t||!t)return(r=new Array(1))[0]=this.removeOne(n),r;if(0===n&&n+t>=o)return r=this.toArray(),this.clear(),r;var s;for(n+t>o&&(t=o-n),r=new Array(t),s=0;s<t;s++)r[s]=this._list[this._head+n+s&this._capacityMask];if(n=this._head+n&this._capacityMask,e+t===o){for(this._tail=this._tail-t+a&this._capacityMask,s=t;s>0;s--)this._list[n=n+1+a&this._capacityMask]=void 0;return r}if(0===e){for(this._head=this._head+t+a&this._capacityMask,s=t-1;s>0;s--)this._list[n=n+1+a&this._capacityMask]=void 0;return r}if(n<o/2){for(this._head=this._head+e+t+a&this._capacityMask,s=e;s>0;s--)this.unshift(this._list[n=n-1+a&this._capacityMask]);for(n=this._head-1+a&this._capacityMask;i>0;)this._list[n=n-1+a&this._capacityMask]=void 0,i--;e<0&&(this._tail=n)}else{for(this._tail=n,n=n+t+a&this._capacityMask,s=o-(t+e);s>0;s--)this.push(this._list[n++]);for(n=this._tail;i>0;)this._list[n=n+1+a&this._capacityMask]=void 0,i--}return this._head<2&&this._tail>1e4&&this._tail<=a>>>2&&this._shrinkArray(),r}}},e.prototype.splice=function(e,t){var r=e;if(r===(0|r)){var n=this.size();if(r<0&&(r+=n),!(r>n)){if(arguments.length>2){var i,o,a,s=arguments.length,c=this._list.length,u=2;if(!n||r<n/2){for(o=new Array(r),i=0;i<r;i++)o[i]=this._list[this._head+i&this._capacityMask];for(0===t?(a=[],r>0&&(this._head=this._head+r+c&this._capacityMask)):(a=this.remove(r,t),this._head=this._head+r+c&this._capacityMask);s>u;)this.unshift(arguments[--s]);for(i=r;i>0;i--)this.unshift(o[i-1])}else{var h=(o=new Array(n-(r+t))).length;for(i=0;i<h;i++)o[i]=this._list[this._head+r+t+i&this._capacityMask];for(0===t?(a=[],r!=n&&(this._tail=this._head+r+c&this._capacityMask)):(a=this.remove(r,t),this._tail=this._tail-h+c&this._capacityMask);u<s;)this.push(arguments[u++]);for(i=0;i<h;i++)this.push(o[i])}return a}return this.remove(r,t)}}},e.prototype.clear=function(){this._head=0,this._tail=0},e.prototype.isEmpty=function(){return this._head===this._tail},e.prototype.toArray=function(){return this._copyArray(!1)},e.prototype._fromArray=function(e){for(var t=0;t<e.length;t++)this.push(e[t])},e.prototype._copyArray=function(e){var t,r=[],n=this._list,i=n.length;if(e||this._head>this._tail){for(t=this._head;t<i;t++)r.push(n[t]);for(t=0;t<this._tail;t++)r.push(n[t])}else for(t=this._head;t<this._tail;t++)r.push(n[t]);return r},e.prototype._growArray=function(){this._head&&(this._list=this._copyArray(!0),this._head=0),this._tail=this._list.length,this._list.length*=2,this._capacityMask=this._capacityMask<<1|1},e.prototype._shrinkArray=function(){this._list.length>>>=1,this._capacityMask>>>=1},exports2=e}const __default1=dew2();function RateLimit(e){return function(t,r,n){const i=n.value,o=new __default1;return n.value=async function(...t){Date.now();for(;o.peekFront()&&Date.now()-o.peekFront()>(e?.interval??1e3);)o.shift();if(o.size()>=(e?.rate??1))throw new RateLimitError("Rate limit exceeded");return o.push(Date.now()),await i.apply(this,t)},n}}function Try(e){return function(t,r,n){const i=n.value;return n.value=async function(...t){try{return await i.apply(this,t)}catch(t){if(t instanceof Error&&e?.catch&&!e.catch.includes(t.constructor.name))throw t;if("string"==typeof t&&e?.catch&&!e.catch.includes(t))throw t;e?.log&&console.error(brightRed1("Runtime exception caught:"),brightYellow1("string"==typeof t?t:t.message)),e?.onError&&e.onError(t)}finally{e?.onDone&&e.onDone()}},n}}const fetchHeader={headers:{}},httpProxy=Deno.env.get("HTTP_PROXY");if(httpProxy){const e=new URL(httpProxy);fetchHeader.headers={Authorization:`Basic ${btoa(e.username+":"+e.password)}`},console.info(`Using HTTP_PROXY (origin="${e.origin}", Authorization="Basic ***...***")`)}let EgoGraph=(_class1=class e{static DEFAULT_GRAPH_DEPTH=1;static DEFAULT_SEARCH_PATTERN=" vs ";static DEFAULT_GRAPH_RADIUS=10;elapsedMs=0;maxDistance=Number.NEGATIVE_INFINITY;constructor(t={query:""}){this.graph=__default(),this.query=t.query,this.depth=t.depth??e.DEFAULT_GRAPH_DEPTH,this.pattern=t.pattern??e.DEFAULT_SEARCH_PATTERN,this.radius=t.radius??e.DEFAULT_GRAPH_RADIUS}async fetchAutocomplete(e,t){const r=e+this.pattern,n=await fetch(`http://suggestqueries.google.com/complete/search?&client=firefox&gl=us&hl=en&q=${encodeURIComponent(r)}`,fetchHeader);if(n.status===Status1.OK){const e=await n.json(),r=new Set;for(const n of e[1].slice(0,t))n.split(this.pattern).slice(1).map((e=>{new RegExp("^[0-9.]+$").test(e)||r.add(e)}));return r}throw new Error(`Fetch error: ${n.status} ${n.statusText}`)}async build(){if(""===this.query)return;const e=performance.now();this.graph.beginUpdate();let t=[this.query],r=[0];for(let e=0;e<this.depth;e++){const n=[],i=[];for(let o=0;o<t.length;o++){const a=r[o];if(a>=this.radius)continue;const s=t[o],c=await this.fetchAutocomplete(s,this.radius-a);this.graph.getNode(s)||this.graph.addNode(s,{count:1,depth:s===this.query?0:e+1});let u=c.size,h=1;c.forEach((t=>{const r=a+h;r>this.maxDistance&&(this.maxDistance=r);const o=this.graph.getNode(t);if(o){o.data.count++;const e=this.graph.getLink(s,t),n=this.graph.getLink(t,s);e||n?e?e.data.weight+=u:n.data.weight+=u:this.graph.addLink(s,t,{distance:r,weight:u,query:`${s}${this.pattern}${t}`})}else this.graph.addNode(t,{count:1,depth:e+1}),this.graph.addLink(s,t,{distance:r,weight:u,query:`${s}${this.pattern}${t}`}),i.push(r),n.push(t);u-=1,h+=1}))}t=n,r=i}this.graph.endUpdate(),this.elapsedMs=performance.now()-e}toObject(){let e=Number.NEGATIVE_INFINITY;this.graph.forEachLink((t=>{t.data.weight>e&&(e=t.data.weight)}));const t={nodes:[],links:[],query:this.query,depth:this.depth,radius:this.radius,maxWeight:e,maxDistance:this.maxDistance,pattern:this.pattern,elapsedMs:this.elapsedMs};return this.graph.forEachNode((e=>{t.nodes.push({id:e.id,...e.data})})),this.graph.forEachLink((e=>{t.links.push({source:e.fromId,target:e.toId,...e.data})})),t}},_dec3=Timeout(1e3),_dec4=Retry({maxAttempts:3}),_applyDecoratedDescriptor1(_class1.prototype,"fetchAutocomplete",[_dec3,_dec4],Object.getOwnPropertyDescriptor(_class1.prototype,"fetchAutocomplete"),_class1.prototype),_dec5=Trace(),_dec6=Timeout(1e4),_applyDecoratedDescriptor1(_class1.prototype,"build",[_dec5,_dec6],Object.getOwnPropertyDescriptor(_class1.prototype,"build"),_class1.prototype),_class1);const SERVER_HOST="0.0.0.0",SERVER_PORT=Deno.env.get("PORT")??"8080",ALLOWED_ORIGINS=["https://ego.jveres.me"],CACHE_EXPIRATION_MS=432e5;let EgoNet=(_class=class{async graph(e){const t=new EgoGraph({query:e.query,depth:e.depth,radius:e.radius});return await t.build(),JSON.stringify(t.toObject())}respond(e,t){return e.respond(t)}async handleQuery(e,t,r){console.log(`${brightGreen(e.method)} ${bold(e.url)}`);const n=await this.graph(t);return this.respond(e,{status:Status.OK,headers:r,body:n})}handleNotAcceptable(e,t){return console.error(`${e.method} ${e.url} ${brightYellow("Not acceptable")}`),this.respond(e,{status:Status.NotAcceptable,headers:t,body:JSON.stringify({message:"Not Acceptable"})})}handleNotFound(e,t){return console.warn(`${e.method} ${e.url} ${brightYellow("Not Found")}`),this.respond(e,{status:Status.NotFound,headers:t,body:JSON.stringify({message:"Request Not Found"})})}handleError(e,t,r){return console.error(`${e.method} ${e.url} ${brightRed(t)}`),this.respond(e,{status:Status.InternalServerError,headers:r,body:JSON.stringify({message:"Internal server error",error:stripColor(t)})})}async startServer(){const e=serve({hostname:"0.0.0.0",port:Number(SERVER_PORT)});console.info(`${brightCyan("Server")} is running at ${bold(underline("0.0.0.0:"+SERVER_PORT))}`),console.info(`Deno: ${brightGreen(Deno.version.deno)} · V8: ${brightGreen(Deno.version.v8)} · TypeScript: ${brightGreen(Deno.version.typescript)}`);for await(const t of e){const e=t.headers.get("origin"),r=new Headers;null!==e&&-1!==ALLOWED_ORIGINS.indexOf(e)&&r.set("Access-Control-Allow-Origin",e);const n=t.headers.get("host"),i=new URLSearchParams(t.url.slice(1));n===`localhost:${SERVER_PORT}`||r.get("Access-Control-Allow-Origin")?"GET"===t.method&&i.get("q")?this.handleQuery(t,{query:i.get("q")??"",...i.get("d")&&{depth:Number(i.get("d"))},...i.get("r")&&{radius:Number(i.get("r"))}},r).catch((async e=>{await this.handleError(t,e.message??e,r)})):this.handleNotFound(t,r):this.handleNotAcceptable(t,r)}}},_dec=Memoize({ttl:432e5,resolver:e=>`${e.query}#${e.depth??EgoGraph.DEFAULT_GRAPH_DEPTH}#${e.pattern??EgoGraph.DEFAULT_SEARCH_PATTERN}#${e.radius??EgoGraph.DEFAULT_GRAPH_RADIUS}`,onAdded:e=>{console.log(`query="${bold(e.split("#")[0])}" added to cache`)},onFound:e=>{console.log(`query="${bold(e.split("#")[0])}" served from cache`)}}),_applyDecoratedDescriptor(_class.prototype,"graph",[_dec],Object.getOwnPropertyDescriptor(_class.prototype,"graph"),_class.prototype),_dec1=Try({catch:["BrokenPipe"],log:!0}),_applyDecoratedDescriptor(_class.prototype,"respond",[_dec1],Object.getOwnPropertyDescriptor(_class.prototype,"respond"),_class.prototype),_dec2=RateLimit({rate:50}),_applyDecoratedDescriptor(_class.prototype,"handleQuery",[_dec2],Object.getOwnPropertyDescriptor(_class.prototype,"handleQuery"),_class.prototype),_class);(new EgoNet).startServer();const ANSI_PATTERN1=new RegExp(["[\\u001B\\u009B][[\\]()#;?]*(?:(?:(?:[a-zA-Z\\d]*(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]*)*)?\\u0007)","(?:(?:\\d{1,4}(?:;\\d{0,4})*)?[\\dA-PR-TZcf-ntqry=><~]))"].join("|"),"g");